<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub Activity</title>
    <style>
        .github-activity-container {
            text-align: center;
            background-color: #007ced;
            color: #FFF;
            padding: 20px;
            max-width: 750px;
            margin: auto;
        }
        .github-activity-heading {
            color: #000;
        }
        /* Include other styles here */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="github-activity-container">
        <h1 class="github-activity-heading">GitHub Activity</h1>
        <table id="github-calendar-table">
            <!-- Calendar and stats HTML -->
        </table>
        <a id="github-link" href="#" target="_blank">View GitHub Profile</a>
    </div>
    <script>
        (function() {
            function getQueryParams() {
                const params = new URLSearchParams(window.location.search);
                return {
                    username: params.get('username'),
                    showHeading: params.get('showHeading') !== 'false',
                    backgroundColor: params.get('backgroundColor') || '#007ced',
                    textColor: params.get('textColor') || '#FFF',
                    headingColor: params.get('headingColor') || '#000',
                    linkColor: params.get('linkColor') || '#007ced',
                    align: params.get('align') || 'center',
                    displayName: params.get('displayName')
                };
            }

            const config = getQueryParams();
            const { username, showHeading, backgroundColor, textColor, headingColor, linkColor, align, displayName } = config;

            if (!username) {
                console.error('GitHub username is required');
                return;
            }

            const container = document.querySelector('.github-activity-container');
            container.style.backgroundColor = backgroundColor;
            container.style.color = textColor;

            const heading = container.querySelector('.github-activity-heading');
            if (showHeading) {
                heading.textContent = `${displayName || username} GitHub Activity`;
                heading.style.color = headingColor;
            } else {
                heading.remove();
            }

            const link = container.querySelector('#github-link');
            link.href = `https://github.com/${username}`;
            link.style.color = linkColor;
            link.style.textAlign = align;

            axios.get(`https://api.github.com/users/${username}/events/public`)
                .then(response => {
                    const events = response.data;
                    const contributions = {};

                    events.forEach(event => {
                        const date = new Date(event.created_at).toISOString().split('T')[0];
                        contributions[date] = (contributions[date] || 0) + 1;
                    });

                    displayCalendar(contributions);
                    displayStats(contributions);
                })
                .catch(error => {
                    console.error('Error fetching GitHub activity:', error);
                });

            function displayCalendar(contributions) {
                const calendar = document.getElementById('github-calendar');
                const monthLabels = document.getElementById('github-month-labels');
                const today = new Date();
                const startDate = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());

                let currentMonth = startDate.getMonth();
                let monthLabel = document.createElement('div');
                monthLabel.textContent = startDate.toLocaleString('default', { month: 'short' });
                monthLabel.style.gridColumnStart = 1;
                monthLabels.appendChild(monthLabel);

                let weekCount = 0;
                let dayCount = 0;

                for (let d = new Date(startDate); d <= today; d.setDate(d.getDate() + 1)) {
                    if (dayCount >= 7 * 53) break; // Limit to 7 rows and 53 columns (one year)

                    if (d.getDay() === 0 && d !== startDate) {
                        weekCount++;
                    }

                    const dateStr = d.toISOString().split('T')[0];
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';

                    const count = contributions[dateStr] || 0;
                    if (count > 0) {
                        dayDiv.classList.add(`contributed-${Math.min(count, 4)}`);
                    }

                    calendar.appendChild(dayDiv);
                    dayCount++;

                    if (d.getMonth() !== currentMonth) {
                        currentMonth = d.getMonth();
                        monthLabel = document.createElement('div');
                        monthLabel.textContent = d.toLocaleString('default', { month: 'short' });
                        monthLabel.style.gridColumnStart = weekCount + 1;
                        monthLabels.appendChild(monthLabel);
                    }
                }
            }

            function displayStats(contributions) {
                const dates = Object.keys(contributions);
                const totalContributions = dates.reduce((sum, date) => sum + contributions[date], 0);
                document.getElementById('github-total-contributions').textContent = totalContributions;

                let longestStreak = 0;
                let currentStreak = 0;
                let maxStreak = 0;
                let lastDate = null;

                dates.sort().forEach(date => {
                    const diff = lastDate ? (new Date(date) - new Date(lastDate)) / (1000 * 60 * 60 * 24) : 0;
                    if (diff === 1) {
                        currentStreak++;
                    } else {
                        maxStreak = Math.max(maxStreak, currentStreak);
                        currentStreak = 1;
                    }
                    lastDate = date;
                });

                longestStreak = Math.max(maxStreak, currentStreak);
                document.getElementById('github-longest-streak').textContent = longestStreak;
                document.getElementById('github-current-streak').textContent = currentStreak;

                const startDate = new Date(dates[0]);
                const endDate = new Date(dates[dates.length - 1]);
                const startMonthYear = startDate.toLocaleString('default', { month: 'short', year: 'numeric' });
                const endMonthYear = endDate.toLocaleString('default', { month: 'short', year: 'numeric' });

                document.getElementById('github-total-date-range').textContent = `${startMonthYear} - ${endMonthYear}`;
            }
        })();
    </script>
</body>
</html>
